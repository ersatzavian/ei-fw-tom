<!DOCTYPE html>
    <html lang='en'>
      <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <meta name='description' content=''>
        <meta name='author' content=''>
    
        <title>Weather</title>
        <link href='data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/4QAAP///wAA0P8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEREREREREAEAAAAAAAAQACIiIiIiIgACIiIiIiIiIAIiIiIiIiIgAiIiIiIiIiAAIiIiIiIiAAEAACIiIAAwAREQIiIgMzABERECIgMzMAERERAAMzMwAREREDMzMzABERERAzMzAAEREREQAAAQAAAAAAAAAACAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAQAA' rel='icon' type='image/x-icon' />        <link href='https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css' rel='stylesheet'>
    
      </head>
      <body>

        <nav id='top' class='navbar navbar-static-top navbar-inverse' role='navigation'>
          <div class='container'>
            <div class='navbar-header'>
              <button type='button' class='navbar-toggle' data-toggle='collapse' data-target='.navbar-ex1-collapse'>
                <span class='sr-only'>Toggle navigation</span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
              </button>
              <a class='navbar-brand'>Weather Dial</a>
            </div>
    
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class='collapse navbar-collapse navbar-ex1-collapse'>
              <ul class='nav navbar-nav'>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container -->
        </nav>
        
        <div class='container'>
          <div class='row' style='margin-top: 20px'>
            <div class='col-md-offset-2 col-md-8 well'>
                <div class='row' style = 'margin-top: 20px; margin-bottom: 20px; margin-left:5px; margin-right: 5px;'>
                    <iframe id='forecast_embed' type='text/html' frameborder='0' height='245' width='100%' src='https://forecast.io/embed/#lat=37.38864136&lon=-122.07505798&name=Mountain View, CA'></iframe>
                </div>
                <div class='input-group'>
                    <input type='text' class='form-control' id='newLocation'>
                    <span class='input-group-btn'>
                        <button class='btn btn-default' type='button' onClick='setLocation()'>Set Location</button>
                    </span>
                </div>
            </div>
          </div>
          <hr>
    
          <footer>
            <div class='row'>
              <div class='col-lg-12'>
                <p class='text-center'>Copyright &copy; Electric Imp 2013 &middot; <a href='http://facebook.com/electricimp'>Facebook</a> &middot; <a href='http://twitter.com/electricimp'>Twitter</a></p>
              </div>
            </div>
          </footer>
          
        </div><!-- /.container -->
    
      <!-- javascript -->
      <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
      <script src='https://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js'></script>
      <script>
      
        var setLocationURL = document.URL+'/setLocation';
        var getLocationURL = document.URL+'/getLocation';
        var forecastBaseURL = 'https://forecast.io/embed/#';

        function setLocation() {
            var location = $('#newLocation').val();
            $.ajax({
                type: 'POST', 
                url: setLocationURL,
                data: location,
                success: function(dataString) {
                    var data = $.parseJSON(dataString);
                    console.log(dataString);
                    var p = $('#forecast_embed').parent();
                    $('#forecast_embed').remove();
                    p.prepend('<iframe id=\'forecast_embed\' type=\'text/html\' frameborder=\'0\' height=\'245\' width=\'100%\' src=\'' + forecastBaseURL+'&lat='+data.lat + '&lon='+data.lon+'&name='+data.name + '\'></iframe>');
                    $('#newLocation').val('');
                }
            });
        }
    
        $(document).ready(function() {
            $.ajax({
                type: 'GET',
                url: getLocationURL,
                success: function(dataString) {
                    console.log(dataString);
                    var data = $.parseJSON(dataString);
                    $('#forecast_embed').attr('src', forecastBaseURL+'&lat='+data.lat + '&lon='+data.lon+'&name='+data.name);
                }
            });
        });
    
      </script>
    </body>    
    </html>